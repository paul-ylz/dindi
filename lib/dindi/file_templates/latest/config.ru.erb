$: << "."

# we use bundler
require 'bundler/setup'

# modular sinatra app
require 'sinatra/base'

# gems
%w(logger json haml digest date time pony).each {|gem| require gem}

# helpers
Dir.glob("./helpers/*.rb").each {|helper| require helper}

# load db config and models
require 'models'

# extra library
Dir.glob("./extlibs/*.rb").each {|extlib| require extlib}

# controllers
Dir.glob("./routes/*.rb").each {|route| require route}

# app file
require '<%= options.project_name %>'

class Sinatra::Base
  # helpers
  include DebugOn

  # set sinatra's variables
  set     :app_name, "<%= options.project_name.gsub(/(?:^|_)(.)/) { $1.upcase } %>" 
  set     :app_logger, ::Logger.new(File.join(File.dirname(__FILE__), 'log', "<%= options.project_name %>.log"))
  set     :root, File.dirname(__FILE__)
  set     :environment, DeploySetting.environment

  if settings.environment == :production
    enable  :sessions, :logging, :dump_errors
    disable :run, :reload, :show_exceptions
  else
    enable  :sessions, :logging, :dump_errors, :show_exceptions
    disable :run, :reload
  end

end

run <%= options.project_name.gsub(/(?:^|_)(.)/) { $1.upcase } %>
