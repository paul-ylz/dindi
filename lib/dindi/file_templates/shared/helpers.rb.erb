module DebugOn

  def debug_on
    logger.info("===== START =====> #{Time.now.strftime("%d/%m/%Y %H:%M %p")}")
    logger.info(request.url)
    logger.info("Params:")
    params.each do |key, value|
      logger.info("\#{key} => \#{value}")
    end
  end

  def app_debug_on
    $APP_LOG.info("===== START =====> #{Time.now.strftime("%d/%m/%Y %H:%M %p")}")
    $APP_LOG.info(request.url)
    $APP_LOG.info("Params:")
    params.each do |key, value|
      $APP_LOG.info("\#{key} => \#{value}")
    end
  end
  
  def app_logger(text)
    $APP_LOG.info(text)
  end
  
  # Basic Authentication
  def protected!
    unless authorized?
      response['WWW-Authenticate'] = %(Basic realm="Restricted Area")
      throw(:halt, [401, "Not authorized\n"])
    end 
  end 

  def authorized?
    @auth ||=  Rack::Auth::Basic::Request.new(request.env)
    @auth.provided? && @auth.basic? && @auth.credentials && @auth.credentials == ['admin', 'dindidocs']
  end  

end
